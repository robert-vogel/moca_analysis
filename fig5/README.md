# Scripts and process used


## Downloading data

The data consists of thumbnails, smaller than full image,
of skin features.  These skin features are classified as
benign or malignant, i.e. a binary classification problem.
This is not a state-of-the art diagnostic tool,
instead we are showing the usefulness of combining predictions
from arbitraily complex data and models.  This model cannot
be used to classify skin features in general or a 
clinical setting, only to be
used in this simple demonstration.
Here we download 3 collections from the ISIC-archive
https://api.isic-archive.com/images/

* MSK-1, collection id = 289
    - 1,678 thumbnail images where diagnoses are either
        confirmed by histopathology and / or "clinical follow-up".
* MSK-2, collection id = 290
    - 4,880 biopsy confirmed thumbnail images
* MSK-4, collection id = 287
    - 2,050 thumbnail images with diagnoses confirmed by histopathology

These data were downloaded using the `download_collections.py` script.
Command line arguments

```bash
python download_collections.py --dir imgs_train 289
python download_collections.py --dir imgs_train 290
python download_collections.py --dir imgs_validate 287
```

Next I checked that the thumbnail images are:

    * License "CC-0", public domain
    * nonempty benign_malignant_field
    * image jpeg file exists

These images are all licensed under the creative commons
license CC-0, that is they are all in the public domain.

```bash
for fname in $(ls imgs_train/*.json); do
    python make_data_table.py -o data/train_set.csv \
        --img_json $fname >> "data/exclude_train_images.tsv"
done

for fname in $(ls imgs_validate/*.json); do
    python make_data_table.py -o data/validate_set.csv \
        --img_json $fname >> "data/exclude_validate_images.tsv"
done
```

Lastly, I check that images are unique using command
line tools

```bash
ls -1 imgs_train/*.jpeg | wc -l
ls -1 imgs_train/*.jpeg | sort | uniq | wc -l
```

A subset of images in each data set didn't have the requisite
metadata and were consequently omitted from the analysis.  In total
we have

* training: 6524 thumbnail images
    - benign: 4508 thumbnail images
    - malignant: 2016 thumbnail images
* validate: 1903 thumbnail images
    - benign: 1164 thumbnail images
    - malignant: 739 thumbnail images


## Transfer learning training

Models pretrained on ImageNet and released throught
tensorflow `tf.keras.applications`

### `MobileNet`

[API documentation](https://www.tensorflow.org/api_docs/python/tf/keras/applications/mobilenet/MobileNet)


*BibTeX Reference*

Citation generated by `arxiv.org`

```
@misc{howard2017mobilenets,
      title={MobileNets: Efficient Convolutional Neural Networks for Mobile Vision Applications}, 
      author={Andrew G. Howard and Menglong Zhu and Bo Chen and Dmitry Kalenichenko and Weijun Wang and Tobias Weyand and Marco Andreetto and Hartwig Adam},
      year={2017},
      eprint={1704.04861},
      archivePrefix={arXiv},
      primaryClass={cs.CV}
}
```


### `InceptionV3`

[API documentation](https://www.tensorflow.org/api_docs/python/tf/keras/applications/inception_v3/InceptionV3)

*BibTeX Reference*

Citation generated by `arxiv.org`

```
@misc{szegedy2015rethinking,
      title={Rethinking the Inception Architecture for Computer Vision}, 
      author={Christian Szegedy and Vincent Vanhoucke and Sergey Ioffe and Jonathon Shlens and Zbigniew Wojna},
      year={2015},
      eprint={1512.00567},
      archivePrefix={arXiv},
      primaryClass={cs.CV}
}
```

### `resnet`

### `nasnet`

### `VGG19`

### `Xception`

## Moca tests

